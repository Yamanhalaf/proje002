<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Proje002 - Oyun</title>
  <style>
    body {
      background: url('galaxy.jpg') no-repeat center center fixed;
      background-size: cover;
      margin: 0;
      padding: 0;
      font-family: Arial;
      color: white;
    }

    #gameArea {
      position: relative;
      margin: auto;
      margin-top: 20px;
      border: 2px solid cyan;
      border-radius: 20px;
      width: 90%;
      max-width: 400px;
      height: 600px;
      background-color: rgba(0, 0, 0, 0.5);
      overflow: hidden;
    }

    .ball {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: red;
      position: absolute;
    }

    #scoreBox, #highscoreBox {
      position: absolute;
      top: 10px;
      right: 10px;
      background: rgba(0,0,0,0.6);
      border: 1px solid white;
      padding: 10px;
      border-radius: 10px;
    }

    #highscoreBox {
      top: 80px;
      max-height: 200px;
      overflow-y: auto;
    }

    #highscoreBox ul {
      padding-left: 20px;
    }
  </style>
</head>
<body>
  <div id="gameArea">
    <div id="scoreBox">Puan: <span id="score">0</span></div>
    <div id="highscoreBox">
      <strong>Skor Tablosu</strong>
      <ul id="scoreList"></ul>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script type="module">
    // Firebase SDK'larını yükle
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-analytics.js";
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    // Firebase yapılandırması
    const firebaseConfig = {
      apiKey: "AIzaSyAvPrYgpMetg9QGh80RvnSUmVXiAA7b_mA",
      authDomain: "proje002-81e2e.firebaseapp.com",
      projectId: "proje002-81e2e",
      storageBucket: "proje002-81e2e.appspot.com",
      messagingSenderId: "29702728042",
      appId: "1:29702728042:web:f3a7e534d58a84a49a5d13",
      measurementId: "G-786EXKB0QF"
    };

    // Firebase'i başlat
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);

    // HTML elemanları
    const gameArea = document.getElementById("gameArea");
    const scoreDisplay = document.getElementById("score");
    const scoreList = document.getElementById("scoreList");

    let score = 0;

    // Top oluştur
    function createBall() {
      const ball = document.createElement("div");
      ball.classList.add("ball");

      const x = Math.random() * (gameArea.clientWidth - 40);
      const y = Math.random() * (gameArea.clientHeight - 40);
      ball.style.left = `${x}px`;
      ball.style.top = `${y}px`;

      ball.addEventListener("click", () => {
        score++;
        scoreDisplay.textContent = score;
        gameArea.removeChild(ball);
        createBall();
      });

      gameArea.appendChild(ball);

      // Top tıklanmazsa oyun biter
      setTimeout(() => {
        if (gameArea.contains(ball)) {
          gameArea.removeChild(ball);
          endGame();
        }
      }, 2000);
    }

    // Oyunu bitir
    async function endGame() {
      alert("Oyun bitti! Skorunuz: " + score);
      await saveScore();
      await showHighScores();
      score = 0;
      scoreDisplay.textContent = "0";
    }

    // Skoru Firebase'e ve localStorage'a kaydet
    async function saveScore() {
      const name = prompt("İsminizi girin:", "Oyuncu") || "İsimsiz";

      // Firebase'e kaydet
      try {
        await addDoc(collection(db, "scores"), { name, score });
      } catch (e) {
        console.error("Firebase'e kaydedilemedi:", e);
      }

      // localStorage'a da kaydet (yedek olarak)
      let highscores = JSON.parse(localStorage.getItem("highscores") || "[]");
      highscores.push({ name, score });
      highscores.sort((a, b) => b.score - a.score);
      highscores = highscores.slice(0, 10);
      localStorage.setItem("highscores", JSON.stringify(highscores));
    }

    // Skorları Firebase'den göster
    async function showHighScores() {
      scoreList.innerHTML = "";

      try {
        const q = query(collection(db, "scores"), orderBy("score", "desc"), limit(10));
        const querySnapshot = await getDocs(q);

        let i = 1;
        querySnapshot.forEach((doc) => {
          const entry = doc.data();
          const li = document.createElement("li");
          li.textContent = `${i++}. ${entry.name} - ${entry.score}`;
          scoreList.appendChild(li);
        });
      } catch (e) {
        console.error("Skorlar alınamadı:", e);
        scoreList.innerHTML = "<li>Skorlar yüklenemedi</li>";
      }
    }

    // Başlangıçta skorları yükle
    showHighScores();

    // Oyun başlasın
    createBall();
  </script>
</body>
</html>
